# ============================================================================
# General Build Settings (applies to entire monorepo)
# ============================================================================

# Use MODULE.bazel (Bzlmod) - required for Bazel 8+ with rules_cuda
# WORKSPACE has circular dependency issues with rules_cc in Bazel 8

# Show errors for failed tests
test --test_output=errors

# Verbose failures
build --verbose_failures

# Enable caching
build --disk_cache=~/.cache/bazel

# Use sandboxing for reproducible builds
build --spawn_strategy=sandboxed
# Fix for CopyFile action failing in darwin-sandbox (macOS-specific issue)
# See: https://github.com/bazelbuild/bazel/issues/7480
build --strategy=CopyFile=local
test --strategy=CopyFile=local

# ============================================================================
# Platform Configurations
# ============================================================================

# CI Configuration (for GitHub Actions without GPU/CUDA)
# Usage: bazel test --config=ci //...
# Skip incompatible targets (those with target_compatible_with constraints that don't match)
build:ci --skip_incompatible_explicit_targets
test:ci --skip_incompatible_explicit_targets

# macOS Configuration (for local development on macOS)
# Usage: bazel test --config=macos //...
build:macos --skip_incompatible_explicit_targets
test:macos --skip_incompatible_explicit_targets

# CUDA Configuration (for local development with GPU)
# Usage: bazel test --config=cuda //...
# No special flags needed - all targets should be compatible

# CUDA architecture settings for WMMA support (Volta+ / SM 7.0+)
build --@rules_cuda//cuda:archs=sm_70,sm_75,sm_80,sm_86,sm_89,sm_90

# ============================================================================
# User-Local Configuration (optional, git-ignored)
# ============================================================================

# Import user-specific settings (e.g., local overrides)
try-import %workspace%/.bazelrc.user
